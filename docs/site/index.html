<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Migrations Module - ProcessWire Migrations module</title>
      
      
        <meta name="description" content="ProcessWire Migrations module">
      
      
        <link rel="canonical" href="https://LostKobrakai.github.io/Migrations/">
      
      
        <meta name="author" content="Benjamin Milde">
      
    
    <meta property="og:url" content="https://LostKobrakai.github.io/Migrations/">
    <meta property="og:title" content="Migrations Module">
    <meta property="og:image" content="https://LostKobrakai.github.io/Migrations//./images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Migrations Module">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="./images/logo.png">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico">
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('./assets/fonts/icon.eot?52m981');
      	src: url('./assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('./assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('./assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('./assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="./assets/stylesheets/application-a422ff04cc.css">
    
      <link rel="stylesheet" href="./assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source Sans Pro:400,700|Source+Code+Pro">
      <style>
        body, input {
          font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Source Code Pro', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="./stylesheets/monokai.css">
    
      <link rel="stylesheet" href="./stylesheets/mystyles.css">
    
    <script src="./assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-light-blue palette-accent-deep-orange">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
          </span>
        
        Migrations Module
      </div>
    </div>
    
      
      <div class="button button-twitter" role="button" aria-label="Twitter">
        <a href="https://twitter.com/lostkobrakai" title="@lostkobrakai on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
      </div>
    
    
      
      <div class="button button-github" role="button" aria-label="GitHub">
        <a href="https://github.com/LostKobrakai" title="@LostKobrakai on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
      </div>
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/LostKobrakai/Migrations" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="./images/logo.png">
        </div>
      
      <div class="name">
        <strong>
          Migrations Module
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          LostKobrakai/Migrations
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/LostKobrakai/Migrations/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/LostKobrakai/Migrations/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Installation" href="installation/">
      Installation
    </a>
    
  </li>

          
            
  <li>
    <a class="current" title="What is it" href=".">
      What is it
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Migration Types" href="#migration-types">
                Migration Types
              </a>
            </li>
          
            <li class="anchor">
              <a title="CLI" href="#cli">
                CLI
              </a>
            </li>
          
            <li class="anchor">
              <a title="Helper Functions" href="#helper-functions">
                Helper Functions
              </a>
            </li>
          
        </ul>
      
    
  </li>

          
            
  <li>
    <a class="" title="How does it work" href="high-level/">
      How does it work
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Usage" href="workflow/">
      Usage
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Collaboration" href="collaboration/">
      Collaboration
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Examples" href="examples/">
      Examples
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Further Links" href="links/">
      Further Links
    </a>
    
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
              
              <li>
                <a href="https://twitter.com/lostkobrakai" target="_blank" title="@lostkobrakai on Twitter">
                  @lostkobrakai on Twitter
                </a>
              </li>
            
            
              
              <li>
                <a href="https://github.com/LostKobrakai" target="_blank" title="@LostKobrakai on GitHub">
                  @LostKobrakai on GitHub
                </a>
              </li>
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <pre style="font-family: 'Source Code Pro'; color: #00AAFF; background-color: white; margin-top: -2.6em">
    ___       ___       ___       ___       ___       ___       ___
   /\__\     /\  \     /\  \     /\  \     /\  \     /\  \     /\  \
  /::L_L_   _\:\  \   /::\  \   /::\  \   /::\  \    \:\  \   /::\  \
 /:/L:\__\ /\/::\__\ /:/\:\__\ /::\:\__\ /::\:\__\   /::\__\ /::\:\__\
 \/_/:/  / \::/\/__/ \:\:\/__/ \;:::/  / \/\::/  /  /:/\/__/ \:\:\/  /
   /:/  /   \:\__\    \::/  /   |:\/__/    /:/  /   \/__/     \:\/  /
   \/__/     \/__/     \/__/     \|__|     \/__/               \/__/
</pre>

<h1 id="intro">Intro<a class="headerlink" href="#intro" title="Permanent link">#</a></h1>
<p>Migrations is a module to manage migration files, which in themselves allow you to handle all the development steps, which affect the ProcessWire database, across multiple enviroments. Be it a simple local development and online live environment by a single developer or multiple developers working in a team with multiple server environments to go through before shipping.</p>
<p>Migration files are simple small class files, which utilize the <a href="https://processwire.com/api/ref/">ProcessWire API</a> to run any database affecting changes. It's not as nice as using the Admin UI directly, but certainly better than trying to migrate changes manually &ndash; possibly weeks after adding the changes. </p>
<p>They are NOT database migrations like you might know them from frameworks like Laravel or Ruby on Rails. Those files won't setup any database tables or change table column types. It's about recreating what normally would be done via the backend UI. Creating a field, removing a field from a template, installing a module and so on.</p>
<p><img alt="Admin UI" src="./images/UI.png" /></p>
<h2 id="migration-types">Migration Types<a class="headerlink" href="#migration-types" title="Permanent link">#</a></h2>
<p>There are currently four types of migrations shipped with the module:</p>
<h3 id="default-migration"><strong>default (Migration)</strong><a class="headerlink" href="#default-migration" title="Permanent link">#</a></h3>
<p>Default migrations are the most free form migrations. There's just a description and two functions – <code>update()</code> and <code>downgrade()</code>. What you're doing in those functions is totally up to you, but it's recommended to try the best to keep changes as reversible as possible. Meaning that running update() and downgrade() once should have as less effect on the installation as possible. The ProcessWire API is available exactly like in modules using the <code>$this-&gt;pages</code>, <code>$this-&gt;config</code>, … syntax.</p>
<h3 id="createdelete-migrations"><strong>Create/Delete Migrations</strong><a class="headerlink" href="#createdelete-migrations" title="Permanent link">#</a></h3>
<ul>
<li><strong>FieldMigration</strong></li>
<li><strong>TemplateMigration</strong></li>
<li><strong>ModuleMigration</strong>  </li>
</ul>
<p>These make your live easier by providing a more declarative way of migrating the creation of Fields/Templates or the installation of modules. All the boilerplate is handled by the base classes these migrations do extend, so you don't need to think about <code>update()</code> and <code>downgrade()</code>. You can rather just describe the item you want to be handled and the rest is been taken care of.</p>
<h2 id="cli">CLI<a class="headerlink" href="#cli" title="Permanent link">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Install the module with composer to use the CLI<p>It will also install all the dependencies and symlink the script to the composer bin-dir. TL;DR it'll make things easier.</p>
</p>
</div>
<p>The module does include a CLI interface, which does allow migrations to be run automatically by Continous Integration Systems or deployment scripts or just by yourself if you like the command-line. I suggest adding 'vendor/bin' to your $PATH variable. Then you can simply call the CLI script by <code>migrate -h</code> from your project root folder. Otherwise you'll need to call it like that: <code>./vendor/migrate -h</code>.</p>
<pre>
> migrate -h

[…]

Usage: migrate [-h, --help] [-i info, --info info] [-m migrate, --migrate migrate] [-n new, --new new] 
  [-nf newField, --newField newField] [-nm newModule, --newModule newModule] 
  [-nt newTemplate, --newTemplate newTemplate] [-r rollback, --rollback rollback]

Optional Arguments:
    -m migrate, --migrate migrate
        Run a specific migration or all new* ones if none given.
        * From latest migrated to newest.
    -r rollback, --rollback rollback
        Undo a specific migration or the latest one if none given.
    -n new, --new new
        Bootstrap a new migrations file. Optionally you can already supply a description.
    -nt newTemplate, --newTemplate newTemplate
        Bootstrap a new template migrations file. Optionally you can already supply a description.
    -nm newModule, --newModule newModule
        Bootstrap a new module migrations file. Optionally you can already supply a description.
    -nf newField, --newField newField
        Bootstrap a new field migrations file. Optionally you can already supply a description.
    -i info, --info info
        Get detailed info about a migration.
    -h, --help
        Show all commands of the cli tool.
</pre>

<h2 id="helper-functions">Helper Functions<a class="headerlink" href="#helper-functions" title="Permanent link">#</a></h2>
<p>There are already a handful of helper function included in the Migration base class, which tackle things I found to need way to much boilerplate for kinda simple changes. Read the code comments on what each of them does.</p>
<div class="admonition note">
<p class="admonition-title">The number of helper functions will probably grow over time.</p>
</div>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * This does use @diogo&#39;s while loop technique to loop over all pages </span>
<span class="sd"> * without getting memory exhaustion. </span>
<span class="sd"> */</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eachPageUncache</span><span class="p">(</span><span class="s2">&quot;template=toBeHidden&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$p</span><span class="p">){</span>
  <span class="nv">$p</span><span class="o">-&gt;</span><span class="na">setAndSave</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="nx">Page</span><span class="o">::</span><span class="na">statusHidden</span><span class="p">);</span>
<span class="p">});</span> 
</pre></div>


<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * $template, $field, $reference = null, $after = true</span>
<span class="sd"> * The below function reads like this:</span>
<span class="sd"> * In the template … add the field … relative to the field … in the position after/before</span>
<span class="sd"> */</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">insertIntoTemplate</span><span class="p">(</span><span class="s1">&#39;basic-page&#39;</span><span class="p">,</span> <span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span> 
</pre></div>


<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * Edit field settings in context of a template</span>
<span class="sd"> */</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">editInTemplateContext</span><span class="p">(</span><span class="s1">&#39;basic-page&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="nv">$template</span><span class="p">){</span>
  <span class="nv">$f</span><span class="o">-&gt;</span><span class="na">label</span> <span class="o">=</span> <span class="s1">&#39;Headline&#39;</span><span class="p">;</span>
<span class="p">});</span> 
</pre></div>


<h3 id="custom-helper-functions">Custom Helper Functions<a class="headerlink" href="#custom-helper-functions" title="Permanent link">#</a></h3>
<p>You can create your own helper functions by using ProcessWire <a href="https://processwire.com/api/hooks/">Hooks</a>. These functions can then be used in your migrations.</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// in ready.php</span>
<span class="nv">$wire</span><span class="o">-&gt;</span><span class="na">addHook</span><span class="p">(</span><span class="s1">&#39;Migration::renameHome&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nx">HookEvent</span> <span class="nv">$event</span><span class="p">){</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">arguments</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">wire</span><span class="p">(</span><span class="s1">&#39;pages&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">setAndSave</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// in the migration::update method</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">renameHome</span><span class="p">(</span><span class="s1">&#39;Root&#39;</span><span class="p">);</span> 
<span class="c1">// in the migration::downgrade method</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">renameHome</span><span class="p">(</span><span class="s1">&#39;Home&#39;</span><span class="p">);</span> 
</pre></div>
          <aside class="copyright" role="note">
            
              Copyright (c) 2016 Benjamin Milde &ndash;
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="installation/" title="Installation">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Installation
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="high-level/" title="How does it work">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                How does it work
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '.';
      var repo_id  = 'LostKobrakai/Migrations';
    </script>
    <script src="./assets/javascripts/application-997097ee0c.js"></script>
    
    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', 'https://www.google-analytics.com/analytics.js', 'ga');
        /* General initialization */
        ga('create', 'UA-81332773-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
        /* Track outbound links */
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
        /* Register handler to log search on blur */
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    
  </body>
</html>