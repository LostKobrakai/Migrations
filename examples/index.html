<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Examples - Migrations Module</title>
      
      
      
        <link rel="canonical" href="https://LostKobrakai.github.io/Migrations/examples/">
      
      
        <meta name="author" content="Benjamin Milde">
      
    
    <meta property="og:url" content="https://LostKobrakai.github.io/Migrations/examples/">
    <meta property="og:title" content="Migrations Module">
    <meta property="og:image" content="https://LostKobrakai.github.io/Migrations/examples//../images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Migrations Module">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="../images/logo.png">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../favicon.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../assets/fonts/icon.eot?52m981');
      	src: url('../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../assets/stylesheets/application-a422ff04cc.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source Sans Pro:400,700|Source+Code+Pro">
      <style>
        body, input {
          font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Source Code Pro', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../stylesheets/monokai.css">
    
      <link rel="stylesheet" href="../stylesheets/mystyles.css">
    
    <script src="../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-light-blue palette-accent-deep-orange">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
          </span>
        
        Examples
      </div>
    </div>
    
      
      <div class="button button-twitter" role="button" aria-label="Twitter">
        <a href="https://twitter.com/lostkobrakai" title="@lostkobrakai on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
      </div>
    
    
      
      <div class="button button-github" role="button" aria-label="GitHub">
        <a href="https://github.com/LostKobrakai" title="@LostKobrakai on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
      </div>
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/LostKobrakai/Migrations" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../images/logo.png">
        </div>
      
      <div class="name">
        <strong>
          Migrations Module
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          LostKobrakai/Migrations
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/LostKobrakai/Migrations/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/LostKobrakai/Migrations/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="What is it" href="..">
      What is it
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="How does it work" href="../workflow/">
      How does it work
    </a>
    
  </li>

          
            
  <li>
    <a class="current" title="Examples" href="./">
      Examples
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Getting started" href="#getting-started">
                Getting started
              </a>
            </li>
          
            <li class="anchor">
              <a title="Specialized Migration Types" href="#specialized-migration-types">
                Specialized Migration Types
              </a>
            </li>
          
        </ul>
      
    
  </li>

          
            
  <li>
    <a class="" title="Further Links" href="../links/">
      Further Links
    </a>
    
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
              
              <li>
                <a href="https://twitter.com/lostkobrakai" target="_blank" title="@lostkobrakai on Twitter">
                  @lostkobrakai on Twitter
                </a>
              </li>
            
            
              
              <li>
                <a href="https://github.com/LostKobrakai" target="_blank" title="@LostKobrakai on GitHub">
                  @LostKobrakai on GitHub
                </a>
              </li>
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="examples">Examples</h1>
<h2 id="getting-started">Getting started</h2>
<p>Migrations are simple small classes, which consist of basically two methods and a static description variable. The two methods are named <code>update()</code> and <code>downgrade()</code> and are called respecively when running the migration or rolling it back.</p>
<p>The most basic migration does therefore look something like this:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Migration_2015_10_21_12_13</span> <span class="k">extends</span> <span class="nx">Migration</span> <span class="p">{</span>

    <span class="sd">/**</span>
<span class="sd">     * Describe what the migration does</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s2">&quot;Doesn&#39;t change anything, just shows messages.&quot;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Is executed when the migration is run</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">(</span><span class="s2">&quot;Ran the update() function!&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Is executed when the migration is rolled back</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">downgrade</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">(</span><span class="s2">&quot;Ran the downgrade() function!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>You might do lot's of different things in those migrations, but I'll just name some examples:</p>
<h3 id="change-a-field-or-template-setting">Change a field or template setting</h3>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nx">test</span>
</pre></div>


<ul>
<li>Add some new pages to the installation</li>
<li>Add a field to a tempate, which wasn't needed before</li>
</ul>
<h2 id="specialized-migration-types">Specialized Migration Types</h2>
<p>Specialized migration types are much simpler to use, because their rollback functionality is much simpler and often tightly coupled to the data needed to run the migration in the first place. Therefore it's enough to supply the information about what to create/add and the deletion will just work as well.</p>
<h3 id="field-migration">Field Migration</h3>
<p>Does create a field and remove it on rollback.</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Migration_2015_10_21_12_15</span> <span class="k">extends</span> <span class="nx">FieldMigration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s2">&quot;Create a new integer field to store the max. number of participants.&quot;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Supply the name of the field</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getFieldName</span><span class="p">(){</span> <span class="k">return</span> <span class="s1">&#39;num_max_participants&#39;</span><span class="p">;</span> <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Supply the type of the field</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getFieldType</span><span class="p">(){</span> <span class="k">return</span> <span class="s1">&#39;FieldtypeInteger&#39;</span><span class="p">;</span> <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Set the field up (it&#39;s saved automatically)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">fieldSetup</span><span class="p">(</span><span class="nx">Field</span> <span class="nv">$f</span><span class="p">){</span>
        <span class="c1">// Base Settings</span>
        <span class="nv">$f</span><span class="o">-&gt;</span><span class="na">label</span> <span class="o">=</span> <span class="s1">&#39;Max. Participants&#39;</span><span class="p">;</span>
        <span class="nv">$f</span><span class="o">-&gt;</span><span class="na">description</span> <span class="o">=</span> <span class="s1">&#39;The maximum number of participants for this event.&#39;</span><span class="p">;</span>
        <span class="nv">$f</span><span class="o">-&gt;</span><span class="na">collapsed</span> <span class="o">=</span> <span class="nx">Inputfield</span><span class="o">::</span><span class="na">collapsedNever</span><span class="p">;</span>

        <span class="c1">// Fieldtype Settings</span>
        <span class="nv">$f</span><span class="o">-&gt;</span><span class="na">zeroNotEmpty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="c1">// Inputfield Settings</span>
        <span class="nv">$f</span><span class="o">-&gt;</span><span class="na">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nv">$f</span><span class="o">-&gt;</span><span class="na">inputType</span> <span class="o">=</span> <span class="s1">&#39;number&#39;</span><span class="p">;</span>

        <span class="c1">// Add this field after the date field in the event template</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">insertIntoTemplate</span><span class="p">(</span><span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="nv">$f</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="template-migration">Template Migration</h3>
<p>Does create a template and remove it on rollback.</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Migration_2015_10_21_12_17</span> <span class="k">extends</span> <span class="nx">TemplateMigration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s2">&quot;Create a new blog-post template&quot;</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Supply the name of the template</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getTemplateName</span><span class="p">(){</span> <span class="k">return</span> <span class="s1">&#39;blog-post&#39;</span><span class="p">;</span> <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Set the field up (it&#39;s saved automatically)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">templateSetup</span><span class="p">(</span><span class="nx">Template</span> <span class="nv">$t</span><span class="p">){</span>
        <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">label</span> <span class="o">=</span> <span class="s1">&#39;Blog-Post&#39;</span><span class="p">;</span>

        <span class="c1">// Global fields are already added</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">insertIntoTemplate</span><span class="p">(</span><span class="nv">$t</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">insertIntoTemplate</span><span class="p">(</span><span class="nv">$t</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;date_published&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">insertIntoTemplate</span><span class="p">(</span><span class="nv">$t</span><span class="p">,</span> <span class="s1">&#39;date_published&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">);</span>

        <span class="c1">// Allow specific urlSegments</span>
        <span class="nv">$t</span><span class="o">-&gt;</span><span class="na">urlSegments</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;comments&#39;</span><span class="p">,</span>
            <span class="s1">&#39;media&#39;</span>
        <span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="module-migration">Module Migration</h3>
<p>This is the simplest migration type. Add the module into the vcs (&gt;3.0 can also use composer) and install it like this. Will only deinstalled the module on rollback.</p>
<div class="admonition note">
<p class="admonition-title">Do not remove the module from the vcs before running the migration<p>Trying to remove a module without it's files will fail. At best just let ProcessWire remove the files in a additional migration, which could also download it on rollback.</p>
</p>
</div>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Migration_2015_10_21_12_16</span> <span class="k">extends</span> <span class="nx">ModuleMigration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s2">&quot;Install LazyCron&quot;</span><span class="p">;</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getModuleName</span><span class="p">(){</span> <span class="k">return</span> <span class="s1">&#39;LazyCron&#39;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
          <aside class="copyright" role="note">
            
              Copyright (c) 2016 Benjamin Milde &ndash;
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../workflow/" title="How does it work">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                How does it work
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../links/" title="Further Links">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Further Links
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '..';
      var repo_id  = 'LostKobrakai/Migrations';
    </script>
    <script src="../assets/javascripts/application-997097ee0c.js"></script>
    
    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', 'https://www.google-analytics.com/analytics.js', 'ga');
        /* General initialization */
        ga('create', 'UA-81332773-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
        /* Track outbound links */
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
        /* Register handler to log search on blur */
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    
  </body>
</html>